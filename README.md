# Kotel
Управление твердотопливным котлом для Arduino Nano

Программа расчитана на экран LCD 1602 I2C. 
Вот так выглядит экран при работе:
```
*-12°<60°   12:34
Растопка котла
```

Где
```
    * - показывет включен ли вентилятор продува
    -12° - текущая температура датчика (--° если обрыв)
    <,= или > - соответствие текущей температуры рабочей (меньше, равно или больше)
    12:34 - текущее время
```
Во второй строке указан текущий режим работы.

В программе есть четыре режима:
* растопка котла
* день
* ночь
* остановка котла

Режимы "День" и "Ночь" отличаются только настройками (время начала и рабочая температура). Любой из этих режимов можно выключить и котел будет работать в оставшемся режиме круглосуточно.

Программа работает следующим образом:
* В момент первого включения включается режим "Растопка котла", включается вентилятор продувки и происходит ожидание нагрева до рабочей дневной температуры. В случае таймаута растопки, котел переходит в режим остановки
* После успешной растопки включается режим "День" или "Ночь" в зависимости от текущего времени
* При превышении температуры выше критической (или обрыве датчика температуры) включается аварийный режим (надпись "АВАРИЯ" и остановка вентиляторов). После нормализации температуры происходит остановка котла
* Периодически (настраивается) включается вентилятор продувки котла
* При остановке котла подаётся высокий сигнал на соответсвующий пин (для зажигания предупреждающей лампы). При нажатии любой кнопки происходит переход в режим "Растопка котла"

Если нужно открыть топку, то нажмите и удерживайте 2 секунды кнопку "влево". Сперва запускается короткая продувка котла и временное отключение всей автоматики с выводом надписи "ПАУЗА" до нажатия любой кнопки.

Если нажать и удерживать 2 секунды кнопку "вправо" то включится на 1 секунду реле сброса золы.

В настоящее время поддерживается только датчик DS18B20 (можно включить другие датчики, но на них программа не тестировалась).

Для удобства отладки просходит вывод описания всех событий и параметров работы в Serial порт (можно отключить в коде). В Serial Monitor в Arduino IDE можно видеть почему произошло то или иное изменение режима работы и когда это произошло.

Для входа в меню нужно нажать и удерживать 2 секунды кнопку "выбор". Навигация по меню:
* Кнопки "вверх" и "вниз" выбирают пунт меню
* Кнопка "влево" закрыть меню
* Кнопка "выбор" позволяет перейти в режим редактирования конкретной настройки

При редактировании настройки действуют следующие кнопки:
* Текущий изменяемый параметры (цифра числа) мигает
* Кнопки "вверх" и "вниз" изменяют текущий параметр (цифру числа)
* Кнпока "влево" выходит из настройки без сохранения изменений
* Длительное нажатие кнопки "Выбор" сохраняет сделенные изменения. При успехе происходит вывод надписи "Сохранено" и возврат в меню настроек. При ошибки (конфликт указанных данных с другими настройками) ничего не происходит и нужно проверить введённые данные.
* Кнопка "вправо" переводит курсор к следующему параметры (цифре числа)
* Кнопка "выбор" переводит курсор к предыдущему параметры (цифре числа)

В файле Kotel.ino идёт распиновка:
* criticalTemp = 88;          // Температура аварии
* pinZolaSbros = 9;           // Реле сброса золы
* pinSignalOstanovKotla = 11; // Сигнал остановки котла
* pinTempSensor = 10;         // Датчик температуры DS18B20
* pinRele = 13;               // Реле вентилятора
* pinKeyL = 2;                // Пин джойстика клавиатуры, кнопка "влево"
* pinKeyD = 3;                // Пин джойстика клавиатуры, кнопка "вниз"
* pinKeyU = 4;                // Пин джойстика клавиатуры, кнопка "вверх"
* pinKeyO = 5;                // Пин джойстика клавиатуры, кнопка "выбор"
* pinKeyR = 6;                // Пин джойстика клавиатуры, кнопка "вправо"

Все остальные параметры настраиваются через меню (длительное нажатие кнопки "выбор").
